<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Aduh Tante</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./public/style.css">
</head>
<body>
    <header id="custom-title-bar">
        <div class="title">Sudah Terbiasa Terjadi Tante</div>
        <div id="window-controls">
            <button id="sound-btn"><img id="toggleSound" src="./public/assets/soundOn.png"></button>
            <button id="loop-btn"><img id="toggleLoop" src="./public/assets/loop.png"></button>
            <button id="home-btn"><img src="./public/assets/home.png"></button>
        </div>
    </header>

    <audio id="audio" src="./public/assets/sound.mp3" preload="auto"></audio>
    <div id="lyrics"><span id="text">Klik di sini untuk mulai</span><span class="cursor">|</span></div>

    <script defer>
        document.getElementById('home-btn').addEventListener('click', () => {
            location.reload();
        });
        
        const toggleLoop = document.getElementById("toggleLoop");
        document.getElementById('loop-btn').addEventListener('click', () => {
            audio.loop = !audio.loop;
            audio.loop ? toggleLoop.src = './public/assets/loopOn.png' : toggleLoop.src = './public/assets/loop.png';
        });
        
        const toggleSound = document.getElementById("toggleSound");
        document.getElementById('sound-btn').addEventListener('click', () => {
            audio.muted = !audio.muted;
            audio.muted ? toggleSound.src = './public/assets/soundMute.png' : toggleSound.src = './public/assets/soundOn.png';
        });

        const audio = document.getElementById("audio");
        
        const lyricContainer = document.getElementById("lyrics");
        lyricContainer.addEventListener("click", () => {
            if (audio.currentTime === 0) {
                audio.play();

                const lyrics = [
                    "Temanku semua pada jahat tante",
                    "Aku lagi susah mereka gak ada",
                    "Coba kalau lagi jaya...",
                    "Aku dipuja-pujanya tante",
                    "Sudah terbiasa terjadi tante",
                    "Teman datang ketika lagi butuh saja",
                    "Coba kalau lagi susah",
                    "Mereka semua menghilang...",
                ];
        
                const settings = [
                //  Delay = Jeda antara object 1 dengan object 2
                //  Speed = Cepatnya teks diketik
                    { delay: 550, speed: 95 },
                    { delay: 900, speed: 110 },
                    { delay: 700, speed: 95 },
                    { delay: 1500, speed: 100 },
                    { delay: 900, speed: 90 },
                    { delay: 1100, speed: 85 },
                    { delay: 900, speed: 100 },
                    { delay: 1500, speed: 100 }
                ];
    
                let index = 0;
                let charIndex = 0;
                const display = document.getElementById('text');
                display.innerText = '';
    
                function typeLine() {
                    if (index >= lyrics.length) {
                        display.textContent = "~";
                        return;
                    }
        
                    const line = lyrics[index];
                    const config = settings[index];
        
                    if (charIndex < line.length) {
                        display.textContent += line.charAt(charIndex);
                        charIndex++;
                        setTimeout(typeLine, config.speed);
                    } else {
                        index++;
                        charIndex = 0;
                        setTimeout(() => {
                            display.textContent = '';
                            typeLine();
                        }, config.delay);
                    }
                }
                function typeOut() {
                    index = 0;
                    charIndex = 0;
                    display.innerText = '';
                    setTimeout(typeLine, 1500);
                }
                typeOut();

                audio.addEventListener('waiting', () => {
                    typeOut();
                })
                audio.addEventListener("ended", () => {
                    audio.currentTime = 0; // Atur currentTime audio jadi 0 biar bisa ditoggle sama if func.
                })
            }
        })
    </script>
</body>
</html>